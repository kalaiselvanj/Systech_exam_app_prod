<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Face Detection with face-api.js</title>
</head>
<body>
  <h1>Face Detection with face-api.js</h1>
  <video id="video" width="640" height="480" autoplay></video>
  <canvas id="canvas" width="640" height="480"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
  <script src="https://cdn.jsdelivr.net/npm/face-api.js"></script>

  <script>
    // Get video and canvas elements
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const context = canvas.getContext('2d');

    // Load the face-api.js models
    Promise.all([
      faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/weights'),
      faceapi.nets.faceLandmark68Net.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/weights'),
      faceapi.nets.faceRecognitionNet.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/weights')
    ]).then(startVideo);

    // Function to start video stream
    function startVideo() {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          video.srcObject = stream;
          detectFaces(); // Start detecting faces
        })
        .catch(error => {
          console.error('Error accessing webcam:', error);
        });
    }

    // Function to detect faces in video frames
    function detectFaces() {
      // Draw video frame on canvas
      context.drawImage(video, 0, 0, canvas.width, canvas.height);

      // Detect faces in the canvas image
      faceapi.detectAllFaces(canvas)
        .then(faces => {
          // Draw face rectangles on canvas
          faces.forEach(face => {
            const { x, y, width, height } = face.box;
            context.lineWidth = 2;
            context.strokeStyle = 'red';
            context.beginPath();
            context.rect(x, y, width, height);
            context.stroke();
          });

          // Repeat detection for the next video frame
          requestAnimationFrame(detectFaces);
        })
        .catch(error => {
          console.error('Error detecting faces:', error);
        });
    }

    // Start the video stream
    startVideo();
  </script>
</body>
</html>
